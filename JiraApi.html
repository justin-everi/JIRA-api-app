<html>
<head>
	<title>JIRA Issues</title>
	<style type="text/css">
		button, div, form, input {
			margin: 10px;
		}
	</style>
</head>
<body>

<div class="container">
  <h1>Issue Search</h1>

  
  <div id="buttonsView"></div>

  <form id="issue-form">
    <label for="issue-input">Find an Issue</label>
    <input type="text" id="issue-input"><br>
    <!--<label for="user-input">UserName: </label>
    <input type="text" id="user-input"><br>
    <label for="pass-input">Password:</label>
    <input type="text" id="pass-input"><br>-->
    
    <!-- Button triggers new issue to be added -->
    <input id="addIssue" type="submit" value="Find an Issue">
  </form>
  <input id="getIssues" type="submit" value="Get Queued Issues">


  <!-- issues will Get Dumped Dere -->
  <div id="issuesView"></div>

<script src='http://code.jquery.com/jquery-2.1.3.min.js'></script>
<script type="text/javascript">

	// Initial array of issues
	var issues = [];

	// ========================================================

	// displayIssueInfo function now re-renders the HTML to display the appropriate content. 
	function displayIssueInfo(){
		//var issue = $(this).attr('data-name');
		var issue = $('#issue-input').val().trim();
		console.log(issue);
		//var user = $('#user-input').val().trim();
		//var pass = $('#pass-input').val().trim();
		var base = "http://jira/rest/api/2/"
		
		var issueURL = "issue/" + issue;
		var issueKeyURL = 'search?jql=issuekey="' + issue + '"'
	
		// Creates AJAX call for the specific issue being 
		$.ajax({url: base + issueKeyURL,method: 'GET'}).done(function(response) {

			// Creates a generic div to hold the issue
			var issueDiv = $('<div class="issue">');
			var issueDiv = $('<div>').attr('class','issue');
			console.log(response);
			console.log(response.issues[0].key);

			// Retrieves the issueKey Data
			var id = response.issues[0].key;
			
			// Creates an element to have the issueKey displayed
			var pOne = $('<p>').text( "Issue Key: " + id);

			// Displays the issueKey
			issueDiv.append(pOne);

			// Retrieves the tasktype
			var taskType = response.issues[0].fields.issuetype.name;
			
			// Creates an element to hold the tasktype
			var pTwo = $('<p>').text( "Task Type: " + taskType);

			// Displays the tasktype
			issueDiv.append(pTwo);

			// Retrieves the game id
			var gameID = response.issues[0].fields.customfield_10023;
			
			// Creates an element to hold the game id
			var pThree = $('<p>').text( "Game ID (SPID): " + gameID);

			// Appends the game id
			issueDiv.append(pThree);

			// Retrieves the game name
			var gameName = response.issues[0].fields.customfield_10280;
			
			// Creates an element to hold the gameName 
			var pFour = $('<p>').text( "Game Name: " + gameName);

			// Appends the gameName
			issueDiv.append(pFour);

			// Retrieves the summary
			var summary = response.issues[0].fields.summary;
			
			// Creates an element to hold the summary 
			var pFour = $('<p>').text( "Summary: " + summary);

			// Appends the summary
			issueDiv.append(pFour);

			// Retrieves the status
			var status = response.issues[0].fields.status.name;
			
			// Creates an element to hold the status 
			var pFour = $('<p>').text( "Status: " + status);

			// Appends the status
			issueDiv.append(pFour);

			// Puts the entire issue above the previous issues.
			$('#issuesView').prepend(issueDiv);
		});

	};

 
	function displayProjectInfo(){
		//var user = $('#user-input').val().trim();
		//var pass = $('#pass-input').val().trim();
		var base = "http://jira/rest/api/2/"
		var projectURL = 'search?jql=project=GP AND issuetype = "Initial Release" AND status = Queued+order+by+duedate&fields=id,key&maxResults=150';

		// Creates AJAX call for the queued project issues
		$.ajax({url: base + projectURL,method: 'GET'}).done(function(response) {

			console.log(response);
			$('#issuesView').text(JSON.stringify(response));
		});
	};

	$('#addIssue').on('click', function(){
		displayIssueInfo();
		
		return false;
	});

	$('#getIssues').on('click', function(){
		displayProjectInfo();
		
		return false;
	});
	


</script>


</body>
</html>
